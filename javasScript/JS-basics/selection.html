<!-- https://javascript.info/selection-range -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
      .intLink {
      cursor: pointer;
      text-decoration: underline;
      color: #0000ff;
    }
    </style>
</head>
<body>
    <textarea name="dd" id="textA" cols="30" rows="10" value="dd"></textarea>
    <input type="text" id="text" >
    <button onclick="getLoc()">Read Caret</button>
    <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
        sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
        sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum.
        Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
        
  
        <!-- <form name="myForm">
          <p>[&nbsp;
            <span class="intLink" id="format-strong"><strong>Bold</strong></span> |
            <span class="intLink" id="format-em"><em>Italic</em></span> |
            <span class="intLink" id="format-link">URL</span> |
            <span class="intLink" id="format-code">code</span> &nbsp;]
          </p>

          <p><textarea name="myTxtArea" rows="10" cols="50">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut facilisis, arcu vitae adipiscing placerat, nisl lectus accumsan nisi, vitae iaculis sem neque vel lectus. Praesent tristique commodo lorem quis fringilla. Sed ac tellus eros. Sed consectetur eleifend felis vitae luctus. Praesent sagittis, est eget bibendum tincidunt, ligula diam tincidunt augue, a fermentum odio velit eget mi. Phasellus mattis, elit id fringilla semper, orci magna cursus ligula, non venenatis lacus augue sit amet dui. Pellentesque lacinia odio id nisi pulvinar commodo tempus at odio. Ut consectetur eros porttitor nunc mollis ultrices. Aenean porttitor, purus sollicitudin viverra auctor, neque erat blandit sapien, sit amet tincidunt massa mi ac nibh. Proin nibh sem, bibendum ut placerat nec, cursus et lacus. Phasellus vel augue turpis. Nunc eu mauris eu leo blandit mollis interdum eget lorem. </textarea></p>
</form> -->
  <script>
      /*const myinput = document.getElementById("textA")

      myinput.addEventListener("selectionchange",()=>{
        console.log(myinput.selectionstart)
        console.log(myinput.selectionEnd)
        console.log(myinput.selectionDirection)
      })
      console.log(myinput); */

      // -------------------------------------------
    
      let textArea = document.getElementById('textA')
      textArea.addEventListener('click', vhange, false)
    function vhange(event){
      let val = event.selectionStart;
      console.log(textArea.selectionStart, "selection")
      
      let range;
      let textNode;
      let offset;
      range = document.caretRangeFromPoint(val.clientX, val.clientY);
        textNode = range.startContainer;
        offset = range.startOffset;
        console.log(range,"range")
        console.log(textNode, "textNode")
        console.log(offset)
    }

    function insertBreakAtPoint(e) {
  

      if (document.caretRangeFromPoint) {
        // console.log(e.clientX, e.clientY,"client")
        range = document.caretRangeFromPoint(e.clientX, e.clientY);
        textNode = range.startContainer;
        offset = range.startOffset;
        // console.log(range,"range")
        // console.log(textNode, "textnode")

        // console.log(offset, "offset")

      let makeString = document.getElementById("textA").textContent;
    
      let storeLeft = [];
      let storeRight = [];
        
      for(let i = offset - 1; makeString.length;i--){
        console.log(i)
        if(makeString[i] === " " || i === -1){
          break;
        }else{
          storeLeft.push(makeString[i])
        }
      };

      for(let i = offset; makeString.length;i++){
        
        if(makeString[i] === " " || i === -1){
          break;
        }else{
          storeRight.push(makeString[i])
        }
      }

      function reverseString(str){
        // Check input 
        if(!str|| str.length < 0||typeof str !== "string"){
          return ' ';
        }

        // Take empty array revArray
        const revArray = [];
        const length = str.length - 1;

        // looping from the end
        for(let i = length; i >= 0; i--){
            revArray.push(str[i]);
        }

        // Joining the array elements
        return  revArray.join('');
      }

      let leftString = reverseString(storeLeft.join('').toString())
      storeLeft = leftString;
      storeRight = storeRight.join('').toString();
      let wordPick = storeLeft + storeRight

      // console.log(wordPick)
      


    } else if (document.caretPositionFromPoint) {
      range = document.caretPositionFromPoint(e.clientX, e.clientY);
      textNode = range.offsetNode;
      offset = range.offset;
    } else {
      document.body.textContent = "[This browser supports neither"
        + " document.caretRangeFromPoint"
        + " nor document.caretPositionFromPoint.]";
      return;
    }
  }

  // -----------------------------------------------------------
  //       let textArea = document.getElementById("textA");
  //       let inputX;
  //       textArea.addEventListener("change", (event)=>{
  //           const input = event.target.value
            
  //           getLoc(input)
  //       }) 

  //       function getLoc(){
  //       const input = document.getElementById("textA");
  //       input.focus();
  //       input.setSelectionRange(2,5);
  //       }
  //       document.getElementById("text").addEventListener("change", (event)=>{
  //       })  
  // function insertBreakAtPoint(e) {
  //   console.log(e, "e")
  // let range;
  // let textNode;
  // let offset;

  // if (document.caretRangeFromPoint) {
  //   console.log(e.clientX, e.clientY,"client")
  //   range = document.caretRangeFromPoint(e.clientX, e.clientY);
  //   textNode = range.startContainer;
  //   offset = range.startOffset;
  //   console.log(range,"range")
  //   console.log(textNode, "textnode")

  //   console.log(offset, "offset")

  //   let makeString = document.getElementsByTagName("p")[0].textContent;
    
  //   let storeLeft = [];
  //   let storeRight = [];
    
  //   for(let i = offset - 1; makeString.length;i--){
  //     console.log(i)
  //     if(makeString[i] === " " || i === -1){
  //       break;
  //     }else{
  //       storeLeft.push(makeString[i])
  //     }
  //   };

  //   for(let i = offset; makeString.length;i++){
      
  //     if(makeString[i] === " " || i === -1){
  //       break;
  //     }else{
  //       storeRight.push(makeString[i])
  //     }
  //   }

  //   function reverseString(str){
  //     // Check input 
  //     if(!str|| str.length < 0||typeof str !== "string"){
  //       return ' ';
  //     }

  //     // Take empty array revArray
  //     const revArray = [];
  //     const length = str.length - 1;

  //     // looping from the end
  //     for(let i = length; i >= 0; i--){
  //         revArray.push(str[i]);
  //     }

  //     // Joining the array elements
  //     return  revArray.join('');
  //   }

  //   let leftString = reverseString(storeLeft.join('').toString())
  //   storeLeft = leftString;
  //   storeRight = storeRight.join('').toString();
  //   let wordPick = storeLeft + storeRight

  //   console.log(wordPick)
    


  // } else if (document.caretPositionFromPoint) {
  //   range = document.caretPositionFromPoint(e.clientX, e.clientY);
  //   textNode = range.offsetNode;
  //   offset = range.offset;
  // } else {
  //   document.body.textContent = "[This browser supports neither"
  //     + " document.caretRangeFromPoint"
  //     + " nor document.caretPositionFromPoint.]";
  //   return;
  // }
  // // Only split TEXT_NODEs

  //   }

  //   let paragraphs = document.getElementsByTagName("p");
  //   paragraphs[0].addEventListener('click', insertBreakAtPoint, false);

  // ===================================================
        //   function insert(startTag, endTag) {
        //   const textArea = document.myForm.myTxtArea;
        //   const selectionStart = textArea.selectionStart;
        //   const selectionEnd = textArea.selectionEnd;
        //   const oldText = textArea.value;

        //   const prefix = oldText.substring(0, selectionStart);
        //   const inserted = startTag +
        //     oldText.substring(selectionStart, selectionEnd) + endTag;
        //   const suffix = oldText.substring(selectionEnd);
        //   textArea.value = `${prefix}${inserted}${suffix}`;

        //   const newSelectionStart = selectionStart + startTag.length;
        //   const newSelectionEnd = selectionEnd + startTag.length;
        //   textArea.setSelectionRange(newSelectionStart, newSelectionEnd);

        //   console.log(selectionStart)

        //   textArea.focus();
        // }

        // function insertURL() {
        // const newURL = prompt("Enter the full URL for the link");
        // if (newURL) {
        //     insert(`<a href="${newURL}">`,"</a>");
        //   } else {
        //     document.myForm.myTxtArea.focus();
        //   }
        // }

        // const strong = document.querySelector("#format-strong");
        // const em = document.querySelector("#format-em");
        // const link = document.querySelector("#format-link");
        // const code = document.querySelector("#format-code");

        // strong.addEventListener("click", (e) => insert("<strong>","</strong>"));
        // em.addEventListener("click", (e) => insert("<em>","</em>"));
        // link.addEventListener("click", (e) => insertURL());
        // code.addEventListener("click", (e) => insert("\n<code>\n","\n</code>\n"));


    </script>
</body>
</html>